<powershell>

#Disable firewall
netsh advfirewall set allprofiles state off

#Install nginx
$nginx_version = "nginx-1.25.3"
Invoke-WebRequest "https://nginx.org/download/${nginx_version}.zip" -OutFile C:\Windows\Temp\nginx.zip -UseBasicParsing
Expand-Archive C:\Windows\Temp\nginx.zip C:\Windows\Temp -Force
Copy-Item "C:\Windows\Temp\$nginx_version" C:\nginx -Recurse -Force

#Download repo
Invoke-WebRequest https://github.com/shyguyCreate/ec2-nginx/archive/refs/heads/main.zip -OutFile C:\Windows\Temp\repo.zip -UseBasicParsing
Expand-Archive C:\Windows\Temp\repo.zip C:\Windows\Temp

#Copy index.html and image to default location
Copy-Item C:\Windows\Temp\ec2-nginx-main\html\* C:\nginx\html -Recurse -Force

#Create nginx service to start automatically
New-Service `
    -Name "Nginx-Flask" `
    -BinaryPathName '"C:\nginx\nginx.exe"' `
    -DisplayName "Nginx Flask" `
    -Description "Nginx service to port forward to Flask app" `
    -StartupType "AutomaticDelayedStart"

#Start nginx service
Start-Service -Name "Nginx-Flask"

</powershell>
